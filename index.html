<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>IPTV Streamer</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* Previous styles remain unchanged */
    </style>
</head>
<body>
    <!-- Same HTML structure as before -->
    
    <script>
        const player = document.getElementById('player');
        const playlistUrl = document.getElementById('playlistUrl');
        const channelList = document.getElementById('channelList');
        let hls = null;

        // Vercel-specific CORS proxy
        const CORS_PROXY = `https://Simply-iptv.vercel.app/api/proxy?`;
        
        async function loadPlaylist(url) {
            try {
                showStatus('Loading playlist...');
                const response = await fetch(CORS_PROXY + url);
                if (!response.ok) throw new Error('Network error');
                const data = await response.text();
                const channels = parsePlaylist(data);
                updateChannelList(channels);
                channelList.disabled = false;
                pipBtn.disabled = false;
                showStatus('Playlist loaded');
            } catch (error) {
                showStatus(`Error: ${error.message}`, true);
            }
        }

        function playStream(url) {
            showStatus('Initializing stream...');
            if (hls) hls.destroy();

            // Use CORS proxy for HLS streams
            const finalUrl = url.includes('m3u8') ? CORS_PROXY + url : url;

            if (Hls.isSupported()) {
                hls = new Hls({
                    xhrSetup: function(xhr) {
                        xhr.withCredentials = false; // Disable credentials for CORS
                    }
                });
                hls.loadSource(finalUrl);
                hls.attachMedia(player);
                
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    showStatus('Playing...');
                    player.play();
                });
                
                hls.on(Hls.Events.ERROR, (event, data) => {
                    showStatus(`HLS Error: ${data.type}`, true);
                });
                
            } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                player.src = finalUrl;
                player.play();
            }
        }

        // Add error listener for native playback
        player.addEventListener('error', () => {
            showStatus('Playback Error: ' + player.error.message, true);
        });

        // Rest of the code remains similar
    </script>
</body>
</html>
